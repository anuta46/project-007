<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}เข้าสู่ระบบ{% endblock %}</title>
    <!-- Google Fonts: Poppins and Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        --glass-bg: rgba(255, 255, 255, 0.25);
        --glass-border: rgba(255, 255, 255, 0.18);
    }
    * { box-sizing: border-box; }
    body {
        font-family: 'Inter', sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        min-height: 100vh; position: relative; overflow-x: hidden;
    }
    .bg-decoration {
        position: fixed; border-radius: 50%; background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px); animation: float 6s ease-in-out infinite; z-index: 1;
    }
    .bg-decoration:nth-child(1){ width:200px;height:200px;top:10%;left:10%;animation-delay:0s;}
    .bg-decoration:nth-child(2){ width:150px;height:150px;top:70%;right:20%;animation-delay:2s;}
    .bg-decoration:nth-child(3){ width:100px;height:100px;bottom:20%;left:20%;animation-delay:4s;}
    @keyframes float { 0%,100%{transform:translateY(0) rotate(0deg);} 50%{transform:translateY(-20px) rotate(180deg);} }

    /* **กล่องหลัก: เน้นกว้างและลดความสูง** */
    .glass-container{
        background: rgba(255,255,255,0.15); backdrop-filter: blur(20px);
        border:1px solid rgba(255,255,255,0.2); border-radius:18px;
        box-shadow: 0 7px 28px rgba(0,0,0,0.1), 0 3.5px 14px rgba(0,0,0,0.1), inset 0 1px 0 rgba(255,255,255,0.3);
        position:relative; z-index:10; 
        max-width:450px; /* คงความกว้างเดิม */
        width:70%; 
        padding:1rem 1.5rem; /* **ลด Padding ด้านบน/ล่างอย่างมาก** */
    }
    /* โลโก้: ลดขนาดและความห่าง */
    .logo-container{
        background: linear-gradient(135deg,#fff 0%,#f8f9fa 100%); 
        width:60px; /* ลดขนาดโลโก้ */
        height:60px; /* ลดขนาดโลโก้ */
        border-radius:15px;
        display:flex;align-items:center;justify-content:center;
        margin:0 auto 1rem; /* **ลดระยะห่างด้านล่าง** */
        box-shadow: 0 5px 10px rgba(0,0,0,0.1), inset 0 1px 0 rgba(255,255,255,0.8);
    }
    .logo-icon{ 
        font-size:1.5rem; 
        background:var(--primary-gradient); -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent; color:#667eea;
    }
    /* หัวข้อ: ลดขนาดและความห่าง */
    h1{ 
        font-family:'Poppins',sans-serif; color:white; font-weight:700; 
        font-size:1.6rem; /* ลดขนาดฟอนต์หัวข้อ */
        text-align:center; 
        margin-bottom:1rem; /* **ลดระยะห่างด้านล่าง** */
        text-shadow:0 1px 2px rgba(0,0,0,0.1);
    }
    .form-field{ margin-bottom:1rem; position:relative;} /* **ลดระยะห่างระหว่างฟอร์ม** */
    .form-field label{ display:block; margin-bottom:0.3rem; font-weight:600; color:white; font-size:0.85rem; text-shadow:0 1px 1px rgba(0,0,0,0.1);}
    .input-container{ position:relative; }
    /* **Input Field: ลดความสูง** */
    .form-field input[type="text"], .form-field input[type="email"], .form-field input[type="password"], .form-field textarea, .form-field select{
        width:100%; 
        padding:0.7rem 0.9rem 0.7rem 2.5rem; /* **ลด Padding ด้านบน/ล่าง** */
        border:2px solid rgba(255,255,255,0.2);
        border-radius:12px; 
        font-size:0.9rem; color:#333; background:rgba(255,255,255,0.9);
        backdrop-filter: blur(8px); transition: all .3s ease; outline:none;
    }
    .form-field input:focus{
        border-color:rgba(255,255,255,0.6); background:rgba(255,255,255,0.95);
        box-shadow:0 0 0 3px rgba(255,255,255,0.2), 0 3px 8px rgba(0,0,0,0.1); transform: translateY(-1px);
    }
    .input-icon{ position:absolute; left:0.8rem; top:50%; transform:translateY(-50%); color:#667eea; font-size:1rem; z-index:1; } 

    /* **ปุ่ม: ลดความสูง** */
    .submit-btn{
        width:100%; 
        padding:0.8rem; /* **ลด Padding ด้านบน/ล่าง** */
        background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
        color:white; font-weight:600; border-radius:12px; border:none; 
        font-size:0.95rem; 
        cursor:pointer;
        margin-top:0.8rem; position:relative; overflow:hidden; transition:all .3s ease;
        box-shadow:0 5px 10px rgba(102,126,234,.3), 0 2px 4px rgba(0,0,0,.1);
    }
    .submit-btn:hover{ transform:translateY(-2px); box-shadow:0 8px 16px rgba(102,126,234,.4), 0 4px 8px rgba(0,0,0,.15);}
    .submit-btn:active{ transform:translateY(-1px); box-shadow:0 5px 10px rgba(102,126,234,.3),0 1px 2px rgba(0,0,0,.1);}
    .submit-btn::before{ content:''; position:absolute; top:0; left:-100%; width:100%; height:100%;
        background:linear-gradient(90deg,transparent,rgba(255,255,255,.3),transparent); transition:left .6s; }
    .submit-btn:hover::before{ left:100%; }

    .messages{ position:fixed; top:15px; left:50%; transform:translateX(-50%); width:90%; max-width:500px; z-index:1000; list-style:none; padding:0; margin:0;}
    .messages li{ padding:0.8rem 1.2rem; margin-bottom:.4rem; border-radius:12px; backdrop-filter:blur(15px); border:1px solid rgba(255,255,255,.3);
        animation:slideInDown .4s ease; box-shadow:0 3px 8px rgba(0,0,0,.1);}
    .messages .success{ background: rgba(34,197,94,.2); color:white; border-color: rgba(34,197,94,.4);}
    .messages .error{ background: rgba(239,68,68,.2); color:white; border-color: rgba(239,68,68,.4);}
    .messages .info{ background: rgba(59,130,246,.2); color:white; border-color: rgba(59,130,246,.4);}
    @keyframes slideInDown{from{opacity:0;transform:translate3d(-50%,-100%,0);}to{opacity:1;transform:translate3d(-50%,0,0);}}

    .errorlist{ color:#fee2e2; font-size:.8rem; list-style:none; padding:0; margin:.4rem 0 0 0; background:rgba(239,68,68,.2);
        backdrop-filter:blur(8px); padding:.4rem 0.8rem; border-radius:6px; border:1px solid rgba(239,68,68,.3);}
    .errorlist li{ margin-bottom:.2rem; } .errorlist li:last-child{ margin-bottom:0; }

    @media (max-width: 640px){
        .glass-container{ padding:1rem 1.25rem; margin:0.6rem; max-width: 90%;} /* ปรับขนาดบนมือถือให้เหมาะสม */
        h1{ font-size:1.5rem;}
        .logo-container{ width:50px;height:50px; margin-bottom:1rem;}
        .logo-icon{ font-size:1.3rem;}
    }

    .loading{ position:relative;}
    .loading::after{ content:''; position:absolute; width:15px;height:15px; top:50%; left:50%; margin-left:-7.5px; margin-top:-7.5px;
        border:2px solid rgba(255,255,255,.3); border-radius:50%; border-top-color:white; animation:spin 1s linear infinite;}
    @keyframes spin{ to{ transform: rotate(360deg);} }
</style>
</head>
<body>
    <div class="bg-decoration"></div>
    <div class="bg-decoration"></div>
    <div class="bg-decoration"></div>

    {% if messages %}
        <ul class="messages">
            {% for message in messages %}
                <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>
                    <i class="fas fa-info-circle mr-2"></i>{{ message|safe }}
                </li>
            {% endfor %}
        </ul>
    {% endif %}

    <main class="min-h-screen flex items-center justify-center p-4">
        <div class="glass-container">
            <div class="logo-container">
                <i class="fas fa-building logo-icon"></i>
            </div>
            <h1>เข้าสู่ระบบ</h1>

            <form method="post" id="loginForm">
                {% csrf_token %}
                {% for field in form %}
                    <div class="form-field">
                        {{ field.label_tag }}
                        <div class="input-container">
                            {% if field.name == 'username' or field.name == 'email' %}
                                <i class="fas fa-user input-icon"></i>
                            {% elif field.name == 'password' %}
                                <i class="fas fa-lock input-icon"></i>
                            {% else %}
                                <i class="fas fa-edit input-icon"></i>
                            {% endif %}
                            {{ field }}
                        </div>
                        {% if field.help_text %}
                            <p class="text-sm text-white opacity-80 mt-1">{{ field.help_text }}</p>
                        {% endif %}
                        {% for error in field.errors %}
                            <ul class="errorlist">
                                <li><i class="fas fa-exclamation-triangle mr-1"></i>{{ error }}</li>
                            </ul>
                        {% endfor %}
                    </div>
                {% endfor %}

                {% if form.non_field_errors %}
                    <ul class="errorlist">
                        {% for error in form.non_field_errors %}
                            <li><i class="fas fa-exclamation-triangle mr-1"></i>{{ error }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}

                {% if next %}<input type="hidden" name="next" value="{{ next }}">{% endif %}

                <button type="submit" class="submit-btn" id="submitBtn">
                    <i class="fas fa-sign-in-alt mr-2"></i>เข้าสู่ระบบ
                </button>
            </form>

            <!-- ปุ่มสมัครสมาชิกผู้ใช้ (ใหม่) + ปุ่มสมัครองค์กร (เดิม) -->
            <div class="mt-6 text-center space-y-3">
                <div class="register-link">
                    ยังไม่มีบัญชีใช่ไหม?
                </div>
                <div class="flex flex-col sm:flex-row items-center justify-center gap-3">
                    <a href="{% url 'register_user_public' %}"
                       class="inline-flex items-center justify-center px-5 py-2.5 rounded-full font-semibold text-white"
                       style="background: var(--secondary-gradient); box-shadow: 0 8px 16px rgba(245,87,108,.35);">
                        <i class="fas fa-user-plus mr-2"></i> สมัครสมาชิกผู้ใช้
                    </a>
                    <a href="{% url 'register_organization' %}"
                       class="inline-flex items-center justify-center px-4 py-2 rounded-full text-white/90 border border-white/40 hover:bg-white/10 transition">
                        <i class="fas fa-building-columns mr-2"></i> ลงทะเบียนองค์กร 
                    </a>
                </div>
            </div>

            <div class="mt-4 text-center text-sm">
                <a href="{% url 'password_reset' %}" class="text-white/90 hover:text-white">
                    ลืมรหัสผ่าน?
                </a>
            </div>
        </div>
    </main>

    <script>
        document.getElementById('loginForm').addEventListener('submit', function() {
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.innerHTML = '<span class="loading"></span>';
            submitBtn.disabled = true;
        });
        setTimeout(function() {
            const messages = document.querySelector('.messages');
            if (messages) {
                messages.style.animation = 'slideInDown 0.5s ease reverse';
                setTimeout(() => messages.remove(), 500);
            }
        }, 5000);
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('focus', function() {
                const icon = this.parentElement.querySelector('.input-icon');
                if (icon) icon.style.color = '#764ba2';
            });
            input.addEventListener('blur', function() {
                const icon = this.parentElement.querySelector('.input-icon');
                if (icon) icon.style.color = '#667eea';
            });
        });
    </script>
</body>
</html>
