<!DOCTYPE html>
<html>
<head>
    <title>Dashboard</title>
</head>
<body>
    <h1>Welcome, {{ user.username }}!</h1>
    <p>This is the dashboard for your organization.</p>
    
    <h2>Organization Details</h2>
    <p>Organization Name: {{ organization.name }}</p>
    <p>Address: {{ organization.address }}</p>
    
    <h2>Items in your organization</h2>
    <ul>
        {% for item in items %}
            <li>{{ item.name }} - Available: {{ item.available_quantity }} / Total: {{ item.quantity }}</li>
        {% empty %}
            <li>No items found.</li>
        {% endfor %}
    </ul>

    <hr>

    <h2>Pending Loan Requests</h2>
    <ul>
        {% for loan in pending_loans %}
            <li>
                {{ loan.borrower.username }} wants to borrow "{{ loan.item.name }}" (Available: {{ loan.item.available_quantity }} / Total: {{ loan.item.quantity }})
                - Request Date: {{ loan.borrow_date|date:"M d, Y" }}
                <a href="{% url 'approve_loan' loan.id %}">Approve</a> | 
                <a href="{% url 'reject_loan' loan.id %}">Reject</a>
            </li>
        {% empty %}
            <li>No pending loan requests.</li>
        {% endfor %}
    </ul>

    <hr>

    {# แสดงปุ่ม "สร้างลิงก์ลงทะเบียนผู้ใช้" เฉพาะเมื่อผู้ใช้เป็นแอดมินองค์กร #}
    {% if user.is_org_admin %}
        <h3>สร้างลิงก์ลงทะเบียนผู้ใช้สำหรับองค์กรของคุณ</h3>
        <form method="post" action="{% url 'generate_registration_link' %}">
            {% csrf_token %}
            <button type="submit">สร้างลิงก์ลงทะเบียน</button>
        </form>
    {% endif %}

    {# ส่วนสำหรับแสดงข้อความจาก Django messages framework #}
    {% if messages %}
        <ul class="messages">
            {% for message in messages %}
                {# ใช้ |safe เพื่อบอก Django ว่าข้อความนี้มี HTML และปลอดภัยที่จะแสดง #}
                <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message|safe }}</li> 
            {% endfor %}
        </ul>
    {% endif %}

    <hr>

    <a href="{% url 'add_item' %}">Add New Item</a> | 
    <a href="{% url 'logout' %}">Logout</a>
</body>
</html>
